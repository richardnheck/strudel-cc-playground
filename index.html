<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Strudel.cc Playground</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: #1e1e1e;
      color: #e0e0e0;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 280px;
      background: #252526;
      border-right: 1px solid #3e3e42;
      overflow-y: auto;
      padding: 15px;
    }

    .sidebar h2 {
      font-size: 14px;
      margin-bottom: 12px;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .snippets-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .snippet-btn {
      padding: 10px 12px;
      background: #2d2d30;
      border: 1px solid #3e3e42;
      color: #e0e0e0;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      border-radius: 3px;
      transition: all 0.2s;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .snippet-btn:hover {
      background: #3d3d40;
      border-color: #007acc;
      color: #fff;
    }

    .snippet-btn.replace {
      background: #1e3a5f;
      border-color: #0078d4;
    }

    .snippet-btn.replace:hover {
      background: #1e4a7a;
    }

    .snippet-btn.append {
      background: #2d5a3d;
      border-color: #107c10;
    }

    .snippet-btn.append:hover {
      background: #3d7a4d;
    }

    .button-group {
      display: flex;
      gap: 4px;
      margin-bottom: 2px;
    }

    .button-group button {
      
      width:30px;
      padding: 4px;
      font-size: 11px;
      border: none;
      border-radius: 3px;
    }

    .btn-replace {
      background: #0078d4;
      color: white;
      cursor: pointer;
    }

    .btn-replace:hover {
      background: #106ebe;
    }

    .btn-append {
      background: #107c10;
      color: white;
      cursor: pointer;
    }

    .btn-append:hover {
      background: #0d6c0d;
    }

    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .controls {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: #252526;
      border-bottom: 1px solid #3e3e42;
    }

    .control-btn {
      padding: 10px 20px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: bold;
    }

    .btn-play {
      background: #107c10;
      color: white;
    }

    .btn-play:hover {
      background: #0d6c0d;
    }

    .btn-update {
      background: #0078d4;
      color: white;
    }

    .btn-update:hover {
      background: #106ebe;
    }

    .btn-stop {
      background: #c42b1c;
      color: white;
    }

    .btn-stop:hover {
      background: #a52517;
    }

    .btn-transfer {
      background: #8a2be2;
      color: white;
    }

    .btn-transfer:hover {
      background: #7a1fd2;
    }

    strudel-repl {
      flex: 1;
    }

    ::-webkit-scrollbar {
      width: 12px;
    }

    ::-webkit-scrollbar-track {
      background: #1e1e1e;
    }

    ::-webkit-scrollbar-thumb {
      background: #464647;
      border-radius: 6px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #5a5a5a;
    }
  </style>
</head>

<body>
  <script src="https://unpkg.com/@strudel/repl@latest"></script>
  <script src="src/js/snippets.js"></script>


  <div class="container">
    <div class="sidebar">
      <h2>Snippets</h2>
      <div class="snippets-container" id="snippetsContainer"></div>
    </div>

    <div class="editor-container">
      <div class="controls">
        <button class="control-btn btn-play" id="playBtn">▶ Play</button>
        <button class="control-btn btn-update" id="updateBtn">↻ Update</button>
        <button class="control-btn btn-stop" id="stopBtn">■ Stop</button>
        <button class="control-btn btn-transfer" id="transferBtn" title="Transfer code to REPL (some code doesn't work in editor for some reason)">⇄ Transfer</button>
      </div>

      <strudel-editor id="repl">
        <!--
            setcps(120/4)       
        -->
      </strudel-editor>

      <script src="https://unpkg.com/@strudel/embed@latest"></script>
      <div id="strudel"></div>
      <!--<strudel-repl>-->
      <!--
      setcps(120/60/4)
    -->
      <!--</strudel-repl>-->
    </div>

  </div>

  <script>
    // Generate snippet buttons
    const container = document.getElementById('snippetsContainer');
    strudelSnippets.forEach((snippet) => {
      const buttonGroup = document.createElement('div');
      const label = document.createElement('span');
      label.textContent = snippet.name;
      label.style.fontSize = '12px';
      label.style.flexGrow = '1';
      buttonGroup.className = 'button-group';

      const nameBtn = document.createElement('button');
      nameBtn.className = 'btn-replace';
      nameBtn.textContent = 'RE';
      nameBtn.title = 'Replace editor code with this snippet';
      nameBtn.onclick = () => insertSnippet(snippet.code);

      const appendBtn = document.createElement('button');
      appendBtn.className = 'btn-append';
      appendBtn.textContent = '+E';
      appendBtn.title = 'Append this snippet to editor code';
      appendBtn.onclick = () => appendSnippet(snippet.code);

      const replBtn = document.createElement('button');
      replBtn.className = 'btn-append';
    
      replBtn.textContent = 'RS';
      replBtn.title = 'Replace Repl code with this snippet';
      replBtn.onclick = () => appendSnippetToRepl(snippet.code);

      buttonGroup.appendChild(label);
      buttonGroup.appendChild(nameBtn);
      buttonGroup.appendChild(appendBtn);
      buttonGroup.appendChild(replBtn);
      container.appendChild(buttonGroup);
    });

    // Control button handlers
    const strudelEditorElement = document.querySelector('strudel-editor');

    document.getElementById('playBtn').onclick = () => {
      console.log('Play button clicked');
      const currentCode = strudelEditorElement.editor.code
      strudelEditorElement.editor.repl.evaluate(currentCode)
    };

    document.getElementById('updateBtn').onclick = () => {
      const currentCode = strudelEditorElement.editor.code
      strudelEditorElement.editor.repl.evaluate(currentCode)
    };

    document.getElementById('stopBtn').onclick = () => {
      console.log('Stop button clicked');
      strudelEditorElement.editor.repl.scheduler.stop();
    };

    document.getElementById('transferBtn').onclick = () => {
      console.log('Transfer button clicked');
      const currentCode = strudelEditorElement.editor.code;
      //const encodedCode = btoa(currentCode);
      //const strudelUrl = `https://strudel.cc/#${encodedCode}`;
      //window.open(strudelUrl, '_blank');
      document.getElementById('strudel').innerHTML = '';
      const replEditor = document.createElement('strudel-repl');
      replEditor.setAttribute(
        'code',
        `${currentCode}`,
      );
       document.getElementById('strudel').append(replEditor);
    };
  </script>
</body>

</html>